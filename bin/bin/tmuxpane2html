#!/bin/bash
set -euo pipefail

pane=""

while [[ $# -gt 0 ]]
do
key="$1"
case $key in
    # Format is what tmux would accept as a valid `target-pane`. See the tmux
    # docs for more info.
    --pane|-t)
        pane="$2"
        shift
        shift
        ;;
    *)
        shift
        ;;
esac
done

[ -z "$pane" ] && echo "--pane required" >&2 && exit 1

tmux capture-pane -t "$pane" -e -b tmuxpane2html_buffer
tmux save-buffer -b tmuxpane2html_buffer /tmp/tmuxpane2html.output
~/.pyenv/versions/ansi2html/bin/ansi2html < /tmp/tmuxpane2html.output
